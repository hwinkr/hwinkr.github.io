{"componentChunkName":"component---src-templates-post-jsx","path":"/react-useeffect-dependencies/","result":{"data":{"site":{"siteMetadata":{"title":"HW.log"}},"markdownRemark":{"id":"95ca4fd5-0536-52de-a4ec-8271cd9b6eda","excerpt":"서론  현재 프로젝트에서 카카오 지도 API를 활용해서 학교 지도 페이지를 구현 하고 있고, 지도 위 건물 번호(카카오 지도가 제공하는 커스텀 오버레이)를 클릭하면 해당 건물에 대한 정보를 보여주는 컴포넌트를 추가로 구현 중에 있었다. 커스텀 오버레이에  이벤트 프로퍼티를 추가해줘도 되지만, 지도 위 건물 번호의 렌더링 로직을 클래스로 구현 했고, 해당 …","html":"<h2 id=\"서론\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%A1%A0\" aria-label=\"서론 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>서론</h2>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/4ffed7b8349a2151bcb4f20541109890/9079b/pknu-map.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 229.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='pknu map' title='' src='/static/4ffed7b8349a2151bcb4f20541109890/9079b/pknu-map.png' srcset='/static/4ffed7b8349a2151bcb4f20541109890/e7570/pknu-map.png 170w,\n/static/4ffed7b8349a2151bcb4f20541109890/f46e7/pknu-map.png 340w,\n/static/4ffed7b8349a2151bcb4f20541109890/9079b/pknu-map.png 548w' sizes='(max-width: 548px) 100vw, 548px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>현재 프로젝트에서 카카오 지도 API를 활용해서 학교 지도 페이지를 구현 하고 있고, 지도 위 건물 번호(카카오 지도가 제공하는 커스텀 오버레이)를 클릭하면 해당 건물에 대한 정보를 보여주는 컴포넌트를 추가로 구현 중에 있었다. 커스텀 오버레이에 <code class=\"language-text\">onClick</code> 이벤트 프로퍼티를 추가해줘도 되지만,</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">ICustomOverlay</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">handleOverlays</span><span class=\"token punctuation\">(</span>buildingTypes<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>BuildingType<span class=\"token punctuation\">,</span> <span class=\"token builtin\">boolean</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> map<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">addOverlay</span><span class=\"token punctuation\">(</span>\n    buildingType<span class=\"token operator\">:</span> BuildingType<span class=\"token punctuation\">,</span>\n    building<span class=\"token operator\">:</span> PKNUBuilding<span class=\"token punctuation\">,</span>\n    map<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomOverlay</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ICustomOverlay</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> overlays<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>BuildingType<span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlays <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">A</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">B</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">C</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">D</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">E</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">createOverlayContent</span><span class=\"token punctuation\">(</span>\n    activeColor<span class=\"token operator\">:</span> CSSProperties<span class=\"token punctuation\">[</span><span class=\"token string\">'color'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    building<span class=\"token operator\">:</span> PKNUBuilding<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLSpanElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//...add style</span>\n\n    <span class=\"token keyword\">const</span> buildingNumberText <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span>building<span class=\"token punctuation\">.</span>buildingNumber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    content<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>buildingNumberText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    content<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token comment\">//... mount building info component</span>\n\n    <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">//...</span></code></pre></div>\n<p>지도 위 건물 번호의 렌더링 로직을 클래스로 구현 했고, 해당 클래스에 리액트 상태 훅인 <code class=\"language-text\">useState</code> 훅을 주입해서 구현하는 것 보다 document에 클릭 이벤트를 추가해서 어떤 건물 번호를 클릭했는지 알아내는 것이 더 낫다고 생각해 해당 방법으로 구현하기로 했다.</p>\n<h2 id=\"문제\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C\" aria-label=\"문제 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>문제</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BuildingInfoToggle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">,</span> setBuildingNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">unmountInfo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setBuildingNumber</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> isInfoMounted <span class=\"token operator\">=</span> buildingNumber <span class=\"token operator\">!==</span> <span class=\"token string\">\"\"</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNumber</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"building number : \"</span><span class=\"token punctuation\">,</span> buildingNumber<span class=\"token punctuation\">)</span> <span class=\"token comment\">// always empty string</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HTMLSpanElement</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> isInfoMounted<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n      <span class=\"token function\">setBuildingNumber</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>innerText<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// eventType : 'touchstart' or 'click'</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> isInfoMounted <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BuildingInfo</span></span> <span class=\"token attr-name\">buildingNumber</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>buildingNumber<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">unmountInfo</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>unmountInfo<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 로직은, document에 클릭 이벤트가 발생할 때마다 지도 위 건물 번호를 클릭한 것인지 확인하고 만약 그렇다면 <code class=\"language-text\">setBuildingNumber</code>를 호출해서 상태를 변경한다. 그리고 건물 정보 컴포넌트가 렌더링 될 때 해당 컴포넌트에서 span을 사용하는 JSX가 있는 경우 <code class=\"language-text\">buildingNumber</code>의 상태가 변경되면 안되므로 <code class=\"language-text\">isInfoMounted</code> 불리언 변수를 사용해 이미 건물 정보 컴포넌트가 렌더링 된 상태라면 <code class=\"language-text\">setBuildingNumber</code>를 호출하지 않도록 early return 패턴을 적용했다.</p>\n<p>하지만, 건물 정보 컴포넌트 위의 <strong>span을 클릭할 때 buildingNumber의 상태가 계속해서 변경되는 문제가 발생했다.</strong> 즉, 적용하려고 했던 early return 패턴이 적용되지 않은 것이다.</p>\n<h2 id=\"원인-파악\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8-%ED%8C%8C%EC%95%85\" aria-label=\"원인 파악 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>원인 파악</h2>\n<p>리액트의 useEffect 훅은 의존성 배열이 비어있다면 해당 컴포넌트가 렌더링 될 때 한번만 실행되며 상태 변화로 인해 컴포넌트가 재호출 되어 리렌더링 되더라도 다시 실행되지 않는다. 만약, 의존성 배열에 어떠한 요소가 있다면 해당 요소가 변할 때마다 useEffect 훅의 첫 번째 인자인 콜백 함수가 실행되며 해당 콜백 함수가 실행되기 전</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>해당 함수가 실행된다.</p>\n<p>이 내용에 대해서 알고 있었지만, 막상 개발을 진행 할 때는 의존성 배열이 비어 있어도 <code class=\"language-text\">buildingNumber</code>의 상태가 변하면 <code class=\"language-text\">getNumber</code> 함수 내부에서 변경된 상태를 참조할 수 있을 것이라고 생각했다.</p>\n<p>자바스크립트에서 함수가 선언될 때, 주위의 환경을 기억한다. 실행되기 전 평가될 때의 렉시컬 환경을 기억한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BuildingInfoToggle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">,</span> setBuildingNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNumber</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"building number : \"</span><span class=\"token punctuation\">,</span> buildingNumber<span class=\"token punctuation\">)</span> <span class=\"token comment\">// always empty string</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HTMLSpanElement</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> isInfoMounted<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n      <span class=\"token function\">setBuildingNumber</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>innerText<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">BuildingInfoToggle</code> 컴포넌트가 제일 처음 렌더링 될 때, <code class=\"language-text\">buildingNumber</code>의 메모리 주소가 만약 100이라면 <code class=\"language-text\">getNumber</code> 함수 내부에서 참조하고 있는 <code class=\"language-text\">buildingNumber</code>의 메모리 주소도 100이 된다. 지도 위 건물 번호를 클릭해 상태가 변경되면 불변성을 유지하기 위해 메모리 주소도 변경 된다.</p>\n<p>하지만, useEffect의 첫 번째 콜백 함수는 의존성 배열이 비어있어 다시 실행되지 않고 따라서 getNumber 함수도 다시 선언되지 않아 메모리 주소가 100인 즉, 빈 문자열인 buildingNumber을 계속해서 참조하게 된다. <strong>따라서 isInfoMounted는 항상 false가 되어 early return 패턴이 적용되지 않았던 것이다.</strong></p>\n<p>그렇다면 useEffect 훅 밖에 getNumber 함수를 선언하면 상태가 변할 때마다 함수를 다시 선언하니 변경된 메모리 주소를 참조해서 문제를 해결할 수 있지 않을까? 라는 생각을 했었다.\n즉,</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BuildingInfoToggle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">,</span> setBuildingNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNumber</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HTMLSpanElement</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> isInfoMounted<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n    <span class=\"token function\">setBuildingNumber</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>innerText<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 밖에 선언하면 변경된 상태를 참조할 수 있을 것이라 생각 했지만, useEffect훅의 첫 번째 콜백 함수 자체가 다시 실행되지 않기 때문에 컴포넌트가 제일 처음 렌더링 됐을 때의 getNumber 함수를 호출하고 해당 함수 내부에서는 buildingNumber 의 상태가 항상 빈 문자열이기 때문에 문제를 해결할 수 없었다.</p>\n<h2 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>해결</h2>\n<p>이 문제를 해결하기 위해서 <strong>의존성 배열에 buildingNumber 를 추가</strong>해줘야 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BuildingInfoToggle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">,</span> setBuildingNumber<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNumber</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">HTMLSpanElement</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> isInfoMounted<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n      <span class=\"token function\">setBuildingNumber</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>innerText<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>eventType<span class=\"token punctuation\">,</span> getNumber<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>buildingNumber<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <strong>buildingNumber가 변경될 때마다 useEffect의 콜백 함수가 다시 실행되어 변경된 메모리 주소를 제대로 참조</strong>할 수 있게 되었고 따라서, early return 패턴도 잘 적용되어 건물 정보 컴포넌트가 렌더링 될 때 예상치 못하게 상태가 변경되는 문제를 해결할 수 있게 되었다. 😊</p>","frontmatter":{"title":"[React] 실수 기록 - useEffect의 의존성 배열 잘 활용하기","date":"January 28, 2024","update":"January 28, 2024","tags":["React","부림이"],"series":"React"},"fields":{"slug":"react-useeffect-dependencies","readingTime":{"minutes":7.485}}},"seriesList":{"edges":[{"node":{"id":"784085fb-34fb-5842-8804-edddebc0fc27","fields":{"slug":"react-usememo"},"frontmatter":{"title":"[React] useMemo는 정말 최적화에 도움이 될까?"}}},{"node":{"id":"1245df48-3b4b-5388-af50-e22ec876a63a","fields":{"slug":"react-jsx-intrinsic-elements"},"frontmatter":{"title":"[React] JSX.intrinsicElements"}}},{"node":{"id":"95ca4fd5-0536-52de-a4ec-8271cd9b6eda","fields":{"slug":"react-useeffect-dependencies"},"frontmatter":{"title":"[React] 실수 기록 - useEffect의 의존성 배열 잘 활용하기"}}},{"node":{"id":"3d76e5ba-6a9b-5517-a1b2-40aa1c77780f","fields":{"slug":"react-use-render-props"},"frontmatter":{"title":"[React] render-props 사용해보기"}}},{"node":{"id":"843e5da9-0fe9-5757-9bc8-59988f1d825a","fields":{"slug":"react-18-concurrent"},"frontmatter":{"title":"[React] React 18 - Concurrent Features"}}},{"node":{"id":"339d3ea6-bce1-5c8a-9428-982cf52ff6e9","fields":{"slug":"reusable-text-component"},"frontmatter":{"title":"재사용할 수 있는 Text 컴포넌트를 만들어 보자"}}}]},"previous":{"fields":{"slug":"react-jsx-intrinsic-elements"},"frontmatter":{"title":"[React] JSX.intrinsicElements"}},"next":{"fields":{"slug":"react-use-render-props"},"frontmatter":{"title":"[React] render-props 사용해보기"}}},"pageContext":{"id":"95ca4fd5-0536-52de-a4ec-8271cd9b6eda","series":"React","previousPostId":"1245df48-3b4b-5388-af50-e22ec876a63a","nextPostId":"3d76e5ba-6a9b-5517-a1b2-40aa1c77780f"}},"staticQueryHashes":[],"slicesMap":{}}